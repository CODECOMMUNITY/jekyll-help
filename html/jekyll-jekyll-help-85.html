<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/jquery.emoji.js"></script>
    <title>Running multiple Jekyll Servers?</title>
  </head>
  <body>
    <div class="container">
      <header>
        <p>
          <span class="badge closed">closed</span>
          <span class="url">jekyll/jekyll-help#85</span>
        </p>
        <h1>Running multiple Jekyll Servers?</h1>
      </header>
      <div class="comments">
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/">andysanchez</a>
            <time>Wednesday, June 25, 2014</time>
          </div>
          <div class="body">
            <p>Hello, I&#39;m extremely pleased with running Jekyll on my own server so far. I was thinking about setting up a few sites for my co-workers to play around with and was wondering what suggestions there are on hosting multiple Jekyll sites?</p>
<p>Ideally, I&#39;d want to use the same EC2 box to run 3 or 4 Jekyll instances. I&#39;d assume I just tell it to run on separate ports and handle the port mapping with virtual hosts?</p>
<p>I couldn&#39;t find any info on this and figured this is the best way to answer, thanks for the pointers :-)</p>

          </div>
        </div>

        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/parkr">
              parkr
            </a>
            <time>Wednesday, June 25, 2014</time>
          </div>
          <div class="body"><p>Hey Andy,</p>
<p>I&#39;m glad you&#39;ve been pleased running Jekyll on your own server so far! What I&#39;d suggest is that you use a stock server (like nginx or apache) and use Jekyll to build your static site to a different directory for each site. On my server, I have a git post-receive hook which takes the repo, clones it to <code>/tmp</code>, and builds it to my <code>/var/www</code> directory for that site. That way, deploying my site is as easy as <code>git push</code>.</p>
<h2 id="example-post-receive-hook">Example <code>post-receive</code> hook</h2>
<pre><code class="lang-bash">source /home/git/.bash_profile # the git user has jekyll installed

REPO_NAME=example.org
GIT_REPO=$HOME/repositories/$REPO_NAME.git # i use gitolite
TMP_GIT_CLONE=/tmp/$REPO_NAME
PUBLIC_WWW=/var/www/$REPO_NAME

git clone $GIT_REPO $TMP_GIT_CLONE

cd $TMP_GIT_CLONE &amp;&amp; jekyll build -s $TMP_GIT_CLONE -d $PUBLIC_WWW --trace
rm -Rf $TMP_GIT_CLONE
exit
</code></pre>
<h2 id="example-nginx-config-goes-in-sites-enabled-">Example <code>nginx</code> config (goes in <code>sites-enabled</code>)</h2>
<pre><code class="lang-nginx">server {
  listen 80;
  server_name example.org;
  root /var/www/example.org;
}
</code></pre>
<p>If you set up one of these post-receive hooks and nginx configurations for each repository, you should be able to use just one aws ec2 instance and one server (nginx) to manage all your jekyll sites.</p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/andysanchez">
              andysanchez
            </a>
            <time>Wednesday, June 25, 2014</time>
          </div>
          <div class="body"><p>Thanks Parker, BTW I checked out your site, the Berlin map looks great!!</p>
<p>What you said above makes sense, however, rather than pulling from Git Hub I&#39;ll be storing the posts on our server, which is why I initially planned on just running them on different ports. BUT running one sounds much better and having ngix do the heavy lifting.</p>
<p>I&#39;m assuming I can look around and track down a bash that keeps an eye out for changes to particular directories and have it build jekyll accordingly?</p>
<p>I just cloned my directory and fired up two sites with <code>jekyll serve</code> in their root directory. Immediately I get the warning there is no config file in the directory, because it&#39;s in the site folders of that directory. I&#39;m assuming I need to update the path in each sites yml, but along those lines Is there a yml i can create to specify where to find each site?</p>
<p>Edit: I apparently just learned how to spell and my post reflects that.</p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/troyswanson">
              troyswanson
            </a>
            <time>Thursday, June 26, 2014</time>
          </div>
          <div class="body"><blockquote>
<p>Is there a yml i can create to specify where to find each site?</p>
</blockquote>
<p>@andysanchez There are a couple options:</p>
<ol>
<li>Include a <code>source</code> flag in the <code>jekyll serve</code> command</li>
<li>Include a <code>source</code> option in <code>_config.yaml</code></li>
</ol>
<p>The documentation for this can be found on the <a href="http://jekyllrb.com/docs/configuration/">Configuration</a> page of the Jekyll product site.</p>
<p>PS: I don&#39;t think you should not be using <code>jekyll serve</code> to host a production website. Ideally, you should use <code>jekyll build</code> along with a <code>destination</code> flag/option to send the processed files to a directory that is being hosted by Apache, nginx, or some other dedicated HTTP service.</p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/andysanchez">
              andysanchez
            </a>
            <time>Thursday, June 26, 2014</time>
          </div>
          <div class="body"><p>Thanks Troy, the source command did it!</p>
<p>I set up my virtual host file to serve the appropriate domain and used <code>build</code> &amp; <code>destination</code> to get it in the correct Apache directory. </p>
<p>Now I suppose only thing I have left is to make a bash script that looks for new posts and builds the correct Jekyll site and processes to correct Apache destination.</p>
<p>...I will say though, after the learning curve of getting this up and running I am so much happier with this than the mess that the database driven CMS (namely the PHP ones) creates.</p>
<p>If anyone has an example of a bash script to handle re-building after a new post is uploaded to a directory that&#39;d be a huge help. Thanks for the responses Parker &amp; Tommy, I got this covered!</p>
<p><em>presses close and does dance</em></p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/troyswanson">
              troyswanson
            </a>
            <time>Thursday, June 26, 2014</time>
          </div>
          <div class="body"><p>:metal: ROCK ON!</p>
<p>I would <em>highly</em> encourage you to write about your exploits. This is a tremendously important workflow that <em>a lot</em> of people will use, so the more lessons and walkthroughs that are out in the wild, the better. :+1: </p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/andysanchez">
              andysanchez
            </a>
            <time>Thursday, June 26, 2014</time>
          </div>
          <div class="body"><p>I absolutely will! I wound up here after years of headaches with Drupal &amp; ExpressionEngine, luckily I managed to stay away from Wordpress. I was attracted to Jekyll because I&#39;m very good at building Shopify themes, so my comfort with Liquid was a major draw. Plus after testing the same page, with each respective platform, I found that Jekyll&#39;s time to paint was around 60 ms, the same Wordpress page was close to 2.5 seconds.</p>
<p>As soon as I saw that the same page, on the same server, was loading over 40 times as fast I was immediately sold. I know as I add complexities to it that&#39;ll go down, but it is a much more logical workflow.</p>
<p>I&#39;ll still need to figure out a solution for more in depth contact forms, but I&#39;m very excited to get my blog running and seeing what I can contribute to the community, namely along the lines of easing people into Liquid.</p>
<p>Thanks again!</p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/troyswanson">
              troyswanson
            </a>
            <time>Thursday, June 26, 2014</time>
          </div>
          <div class="body"><blockquote>
<p>I&#39;ll still need to figure out a solution for more in depth contact forms</p>
</blockquote>
<p>@andysanchez Sounds like a great topic for a <a href="https://github.com/jekyll/jekyll-help/issues/new">new issue</a>!</p>
</div>
        </div>
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/parkr">
              parkr
            </a>
            <time>Monday, June 30, 2014</time>
          </div>
          <div class="body"><blockquote>
<p>rather than pulling from Git Hub I&#39;ll be storing the posts on our server, which is why I initially planned on just running them on different ports</p>
</blockquote>
<p>I don&#39;t pull from GitHub for this, I push to my own server with gitolite installed (though that detail is unnecessary). I use the SSH protocol (<code>git@myserver.com:repo.git</code>) and the <code>post-receive</code> hook is executed when the git server has received the entire push contents. It&#39;s super convenient and totally customizable.</p>
<blockquote>
<p>I&#39;m assuming I can look around and track down a bash that keeps an eye out for changes to particular directories and have it build jekyll accordingly?</p>
</blockquote>
<p>You could do an upstart process to run <code>jekyll build -w</code>, maybe? I&#39;ve always relied on the system I described before to build whenever the git repo receives an update.</p>
<blockquote>
<p>I&#39;m assuming I need to update the path in each sites yml, but along those lines Is there a yml i can create to specify where to find each site?</p>
</blockquote>
<p>I&#39;d suggest running <code>jekyll build</code> or <code>jekyll serve</code> with the <code>--source</code> and <code>--destination</code> switches for this!</p>
</div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function(){
        $('.comment').each(function(i, d){
          $(d).emoji()
        })
      })
    </script>

  </body>
</html>
