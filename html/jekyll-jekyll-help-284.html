<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/jquery.emoji.js"></script>
    <title>Include tags not rendering when called from plugin</title>
  </head>
  <body>
    <div class="container">
      <header>
        <p>
          <span class="badge open">open</span>
          <span class="url">jekyll/jekyll-help#284</span>
        </p>
        <h1>Include tags not rendering when called from plugin</h1>
      </header>
      <div class="comments">
        <div class="comment">
          <div class="meta">
            <a class="person" href="https://github.com/">egardner</a>
            <time>Thursday, March 19, 2015</time>
          </div>
          <div class="body">
            <p>I&#39;m trying to write a basic generator plugin that creates a JSON version of each page in my site.
I&#39;ve got this working, with one exception: <code>{% include %}</code> tags in the content of the pages are not being rendered when the JSON version of a page is created.</p>
<p>These tags <strong>are</strong> being rendered when Jekyll creates the standard HTML version of the pages, however, so I don&#39;t understand what I&#39;m missing. </p>
<p>Here&#39;s the content of my plugin file (adapted from <a href="https://github.com/jgarber623/sixtwothree.org/blob/master/src/_plugins/json_page_generator.rb">here</a>:</p>
<pre><code class="lang-ruby">module Jekyll
  class JSONPage &lt; Page
    def initialize(site, base, dir, name, content)
      @site = site
      @base = base
      @dir  = dir
      @name = name

      self.data = {}
      self.content = content

      process(@name)
    end

    def read_yaml(*)
      # Do nothing
    end

    def render_with_liquid?
      false
    end
  end

  class JSONPostGenerator &lt; Generator
    safe true

    def generate(site)

      site.pages.each do |page|
        if page.html?

          path = page.destination(&quot;&quot;).sub &quot;.html&quot;, &quot;.json&quot;

          output = page.to_liquid

          output[&#39;content&#39;] = page.transform

          site.pages &lt;&lt; JSONPage.new(site, site.source, File.dirname(path), File.basename(path), output.to_json)
        end
      end

    end

  end
end
</code></pre>
<p>In each of my pages, I&#39;m calling one or more <code>include</code> tags in the markdown content of the page and passing params. For example:</p>
<pre><code class="lang-liquid">{% include compare.html first_figure=&quot;1a&quot; second_figure=&quot;1b&quot; %}
</code></pre>
<p>The HTML output of <code>jekyll build</code> renders that line as the following HTML:</p>
<pre><code class="lang-html">&lt;figure class=&quot;compare&quot;&gt;
  &lt;img class=&quot;lazyload&quot; data-src=&quot;images/001a.jpg&quot; alt=&quot;Figure1a&quot; id=&quot;fig1a&quot; /&gt;
  &lt;img class=&quot;lazyload&quot; data-src=&quot;images/001b.jpg&quot; alt=&quot;Figure1b&quot; id=&quot;fig1b&quot; /&gt;
  &lt;figcaption&gt;
    &lt;span&gt;&lt;strong&gt;Figure 1a.&lt;/strong&gt; Riace Bronze A. Greek, mid-5th century B.C. H: 1.98 m (ca. 6½ ft.).Reggio Calabria, Museo Nazionale.&lt;/span&gt;
    &lt;span&gt;&lt;strong&gt;Figure 1b.&lt;/strong&gt; Riace Bronze B. Greek, mid-5th century B.C. H: 1.97 m (ca. 6½ ft.).Reggio Calabria, Museo Nazionale.&lt;/span&gt; 
  &lt;/figcaption&gt;
&lt;/figure&gt;
</code></pre>
<p>This is all working as it should. However, the JSON output of the same page (which is otherwise correct, complete with front-matter properly formatted) still has the raw <code>{% include compare.html %}</code> in its content; it&#39;s not being rendered by Jekyll.</p>
<p>I would assume that calling <code>page.transform</code> in the plugin would &quot;transform&quot; this particular content, but that&#39;s not happening. Any ideas?</p>
<p>Sample (abbreviated) JSON output below – HTML content is otherwise rendering, escaping, etc. – but Jekyll-specific <code>{%include%}</code> syntax is untouched...</p>
<pre><code class="lang-json">{
  &quot;id&quot;: 0,
  &quot;title&quot;: &quot;Foreward&quot;,
  &quot;cover_image&quot;: &quot;023.jpg&quot;,
  &quot;content&quot;: &quot;&lt;p&gt;Fact and fiction mingle in the classical myth of Talos, a Cretan giant made of bronze... &lt;/p&gt;\n\n&lt;p&gt;{% include compare.html first_figure=\u201d1a\u201d second_figure=\u201d1b\u201d %}&lt;/p&gt;&quot;
}
</code></pre>

          </div>
        </div>

      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function(){
        $('.comment').each(function(i, d){
          $(d).emoji()
        })
      })
    </script>

  </body>
</html>
